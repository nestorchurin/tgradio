# üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

## –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

### –û—Å–Ω–æ–≤–Ω—ñ –ø–∞–∫–µ—Ç–∏ (requirements.txt)
- **pyrogram** - Telegram MTProto API framework
- **pytgcalls** - Voice chats integration
- **pyyaml** - YAML configuration parsing
- **ntgcalls** - Native calls backend
- **cryptg** - Fast cryptography for Pyrogram

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
```bash
# –û—Å–Ω–æ–≤–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install -r requirements.txt

# –†–æ–∑—Ä–æ–±–Ω–∏—Ü—å–∫—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ  
pip install -r requirements-dev.txt

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–±
pip install -e .
```

### –í–µ—Ä—Å—ñ—ó
- Python: 3.11+
- PyTgCalls: 2.2.5+
- Pyrogram: 2.0.106+

## –ú–æ–¥—É–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```mermaid
graph TD
    A[main.py] --> B[utils/radio.py]
    B --> C[utils/autoplay.py]
    B --> D[utils/pytgcalls_handler.py]
    B --> E[utils/audio.py]
    B --> F[utils/config.py]
    C --> D
    C --> E
    D --> G[PyTgCalls]
    A --> H[Pyrogram]
```

## –ú–æ–¥—É–ª—ñ

### main.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∑ Pyrogram userbot  
**–§—É–Ω–∫—Ü—ñ—ó:**
- –û–±—Ä–æ–±–∫–∞ –∫–æ–º–∞–Ω–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É
- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ö–æ–º–∞–Ω–¥–∏:**
```python
@app.on_message(filters.command("radio", prefixes=pref) & admin_filter)
async def radio_command(client, message)
```

### utils/config.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó  
**–§—É–Ω–∫—Ü—ñ—ó:**
- –ß–∏—Ç–∞–Ω–Ω—è YAML —Ñ–∞–π–ª—É –∑ UTF-8
- –ï–∫—Å–ø–æ—Ä—Ç –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö CONFIG —Ç–∞ RADIO_CONFIG

**–ï–∫—Å–ø–æ—Ä—Ç:**
```python
CONFIG = config
RADIO_CONFIG = config["radio_settings"]
```

### utils/audio.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞—É–¥—ñ–æ —Ñ–∞–π–ª–∞–º–∏  
**–§—É–Ω–∫—Ü—ñ—ó:**
- `get_random_music()` - –í–∏–ø–∞–¥–∫–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Ç—Ä–µ–∫
- `get_random_jingle()` - –í–∏–ø–∞–¥–∫–æ–≤–∏–π –¥–∂–∏–Ω–≥–ª
- `get_random_ads()` - –í–∏–ø–∞–¥–∫–æ–≤–∞ —Ä–µ–∫–ª–∞–º–∞
- `get_track_name()` - –í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ —Ç—Ä–µ–∫—É

**–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏:** .mp3, .wav, .flac, .m4a, .ogg

### utils/pytgcalls_handler.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∞ —Ä–æ–±–æ—Ç–∞ –∑ PyTgCalls  
**–§—É–Ω–∫—Ü—ñ—ó:**
- `init_pytgcalls(client)` - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
- `start_pytgcalls()` - –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É
- `play_audio_file(chat_id, file_path)` - –í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É
- `change_volume(chat_id, volume)` - –ó–º—ñ–Ω–∞ –≥—É—á–Ω–æ—Å—Ç—ñ
- `check_connection(chat_id)` - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ:**
- `pytg` - –ï–∫–∑–µ–º–ø–ª—è—Ä PyTgCalls
- `current_volume` - –ü–æ—Ç–æ—á–Ω–∞ –≥—É—á–Ω—ñ—Å—Ç—å
- `is_started` - –°—Ç–∞—Ç—É—Å –∑–∞–ø—É—Å–∫—É

### utils/autoplay.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É  
**–§—É–Ω–∫—Ü—ñ—ó:**
- `auto_play_loop(chat_id)` - –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª
- `next_music_instant(chat_id)` - –ú–∏—Ç—Ç—î–≤–µ –ø–µ—Ä–µ–º–∫–Ω–µ–Ω–Ω—è
- `play_jingle_now(chat_id)` - –í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∂–∏–Ω–≥–ª–∞
- `play_ads_now(chat_id)` - –í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∫–ª–∞–º–∏
- `stop_autoplay()` - –ó—É–ø–∏–Ω–∫–∞ —Ü–∏–∫–ª—É

**–õ–æ–≥—ñ–∫–∞ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è:**
```python
if tracks_played % RADIO_CONFIG["ads_frequency"] == 0:
    # –†–µ–∫–ª–∞–º–∞
elif tracks_played % RADIO_CONFIG["jingle_frequency"] == 0:
    # –î–∂–∏–Ω–≥–ª
else:
    # –ú—É–∑–∏–∫–∞
```

### utils/radio.py
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –í–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π API  
**–§—É–Ω–∫—Ü—ñ—ó:**
- `init_radio(client)` - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
- `join_voice(chat_id)` - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —á–∞—Ç—É
- `leave_voice(chat_id)` - –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- `next_track(chat_id)` - –†—É—á–Ω–µ –ø–µ—Ä–µ–º–∫–Ω–µ–Ω–Ω—è
- `set_volume(chat_id, volume)` - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—É—á–Ω—ñ—Å—Ç—é

**–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è task'–∞–º–∏:**
```python
autoplay_task = asyncio.create_task(auto_play_loop(chat_id))
```

## –ü–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫ —Ä–∞–¥—ñ–æ ($radio)
1. `main.py` –æ—Ç—Ä–∏–º—É—î –∫–æ–º–∞–Ω–¥—É
2. –í–∏–∫–ª–∏–∫–∞—î `radio.join_voice()`
3. `radio.py` —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î PyTgCalls
4. –í—ñ–¥—Ç–≤–æ—Ä—é—î –ø–µ—Ä—à–∏–π —Ç—Ä–µ–∫
5. –ó–∞–ø—É—Å–∫–∞—î `autoplay.auto_play_loop()`
6. –¶–∏–∫–ª –ø—Ä–∞—Ü—é—î –¥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ü–∏–∫–ª
1. –ß–µ–∫–∞—î `track_duration` —Å–µ–∫—É–Ω–¥
2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
3. –ó–±—ñ–ª—å—à—É—î –ª—ñ—á—ñ–ª—å–Ω–∏–∫ —Ç—Ä–µ–∫—ñ–≤
4. –í–∏–∑–Ω–∞—á–∞—î —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç—É –∑–∞ —á–∞—Å—Ç–æ—Ç–æ—é
5. –í—ñ–¥—Ç–≤–æ—Ä—é—î –∫–æ–Ω—Ç–µ–Ω—Ç
6. –ü–æ–≤—Ç–æ—Ä—é—î —Ü–∏–∫–ª

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
1. **–†–µ–∫–ª–∞–º–∞** - –Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
2. **–î–∂–∏–Ω–≥–ª** - —Å–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç  
3. **–ú—É–∑–∏–∫–∞** - –±–∞–∑–æ–≤–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç

## –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

### autoplay.py
- `tracks_played` - –õ—ñ—á—ñ–ª—å–Ω–∏–∫ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–∏—Ö —Ç—Ä–µ–∫—ñ–≤
- `autoplay_running` - –°—Ç–∞—Ç—É—Å —Ä–æ–±–æ—Ç–∏ —Ü–∏–∫–ª—É

### pytgcalls_handler.py
- `pytg` - –ï–∫–∑–µ–º–ø–ª—è—Ä PyTgCalls
- `is_started` - –°—Ç–∞—Ç—É—Å –∑–∞–ø—É—Å–∫—É PyTgCalls
- `current_volume` - –ü–æ—Ç–æ—á–Ω–∞ –≥—É—á–Ω—ñ—Å—Ç—å
- `client_instance` - Pyrogram –∫–ª—ñ—î–Ω—Ç

### radio.py
- `autoplay_task` - AsyncIO task –∞–≤—Ç–æ–ø–ª–µ–π

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### –†—ñ–≤–Ω—ñ –æ–±—Ä–æ–±–∫–∏
1. **PyTgCalls —Ä—ñ–≤–µ–Ω—å** - –ë–∞–∑–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
2. **Autoplay —Ä—ñ–≤–µ–Ω—å** - –ü–æ–º–∏–ª–∫–∏ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è, –ø–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏
3. **Radio —Ä—ñ–≤–µ–Ω—å** - –ü–æ–º–∏–ª–∫–∏ –≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è
4. **Main —Ä—ñ–≤–µ–Ω—å** - –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–∞–Ω–¥, –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É

### –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
- **–í—Ç—Ä–∞—Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤–∏—Ö—ñ–¥ –∑ —Ü–∏–∫–ª—É
- **–ü–æ–º–∏–ª–∫–∞ —Ñ–∞–π–ª—É** - –ü—Ä–æ–ø—É—Å–∫ —Ç–∞ –ø–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ
- **–ü–æ–º–∏–ª–∫–∞ –≥—É—á–Ω–æ—Å—Ç—ñ** - –õ–æ–≥—É–≤–∞–Ω–Ω—è –±–µ–∑ –∑—É–ø–∏–Ω–∫–∏
- **–ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏** - –ó—É–ø–∏–Ω–∫–∞ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –í–∞–ª—ñ–¥–∞—Ü—ñ—è
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤ –∑–Ω–∞—á–µ–Ω—å

### –ì–∞—Ä—è—á—ñ –∑–º—ñ–Ω–∏
–î–ª—è –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞.

### –ë–µ–∑–ø–µ–∫–∞
- API –∫–ª—é—á—ñ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –†—É—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
1. `$radio` - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
2. `$next` - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–º–∫–Ω–µ–Ω–Ω—è
3. `$vol` - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—É—á–Ω–æ—Å—Ç—ñ
4. `$stop` - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

### –Æ–Ω—ñ—Ç —Ç–µ—Å—Ç–∏
```python
# –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É
async def test_get_random_music():
    music_file = get_random_music()
    assert music_file is not None
    assert os.path.exists(music_file)
```

## –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ñ–∞–π–ª–∞–º–∏

### –ü–∞–º'—è—Ç—å
- –ù–µ–º–∞—î –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤
- –°–≤–æ—î—á–∞—Å–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è task'—ñ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö

## –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∫–æ–º–∞–Ω–¥
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ handler –≤ `main.py`
2. –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –º–æ–¥—É–ª—å
3. –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

### –ù–æ–≤—ñ —Ç–∏–ø–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
1. –†–æ–∑—à–∏—Ä–∏—Ç–∏ `audio.py`
2. –î–æ–¥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –≤ `autoplay.py`  
3. –û–Ω–æ–≤–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é

### API —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤–µ–± API
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –º—É–∑–∏—á–Ω–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏
- –°–∏—Å—Ç–µ–º–∏ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

## –ë–µ–∑–ø–µ–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
- –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- –û–±–º–µ–∂—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–∞–π–ª—ñ–≤ –±–æ—Ç–∞
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ HTTPS –¥–ª—è API

### –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å  
- API –∫–ª—é—á—ñ –Ω–µ –ª–æ–≥—É—é—Ç—å—Å—è
- –û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É

---

**–í–µ—Ä—Å—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:** 1.0  
**–î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** –°–µ—Ä–ø–µ–Ω—å 2025
